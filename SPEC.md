# Hand Note 仕様書

## 1. 概要
- Hand Note は、メモを作成・管理できる Flutter アプリです。
- ローカル SQLite にメモとステータスを保存し、ホームウィジェットと同期します。
- テーマは Light / Dark / System（Auto）を切り替え可能です。

## 2. 対象プラットフォーム
- Flutter アプリ（Android / iOS）
- ローカル保存：SQLite（`sqflite`）
- ホームウィジェット連携（HomeWidget）

## 3. 主要機能

### 3.1 メモ作成
- テキスト入力欄でメモ本文を入力し、「メモを作成」で保存します。
- 空文字の場合は保存せず、エラーを通知します。
- 保存後は入力欄をクリアし、ホームウィジェットへ同期します。
- デフォルトのステータスは「未完了（status_id=2）」です。

### 3.2 メモ一覧
- メモ一覧をカード形式で表示します。
- 引き下げ操作でリロードできます。
- メモが存在しない場合は「まだメモがありません」を表示します。

#### 3.2.1 検索
- 検索バーでメモ本文をローカル検索し、部分一致で絞り込みます。
- 検索ワードが空の場合は全件に戻ります。

#### 3.2.2 編集
- カードの本文をタップするとインライン編集が開始されます。
- 編集完了（フォーカスアウト）で更新し、ホームウィジェットへ同期します。

#### 3.2.3 削除
- カードをスワイプすると削除します。

#### 3.2.4 ステータス操作
- ステータスの丸をタップすると完了/未完了をトグルします。
- ステータス名をタップすると sort_no 順でステータスを順送りします。
- ステータスの丸を長押しするとステータス一覧モーダルを開き、任意のステータスへ変更できます。

### 3.3 設定

#### 3.3.1 表示モード
- Light / Dark / Auto（System）を切り替え可能です。
- 設定は SharedPreferences に保存されます。

#### 3.3.2 ステータス管理
- ステータス一覧を表示し、並び替え（ドラッグ）できます。
- ステータス名はインラインで編集できます。
- ステータス色は長押しで変更できます。
- 「完了」「未完了」は固定ステータスで削除できません。
- カスタムステータスは最大 4 件まで追加できます。

#### 3.3.3 アプリ情報
- 設定画面にアプリ情報セクションを表示します。

### 3.4 ホームウィジェット連携
- アプリ → ホームウィジェット：
  - メモとステータスを JSON 化して保存し、ウィジェットを更新します。
  - メモは更新日時の新しい順で最大 4 件まで送信します。
- ホームウィジェット → アプリ：
  - SharedPreferences のデータを読み込み、メモを DB に反映（upsert）します。
- ウィジェットからの起動時は、対象メモを一覧で編集状態にします。

## 4. 画面構成

### 4.1 メインタブ
- タブ構成：メモ作成 / メモ一覧 / 設定
- ヘッダー、ボトムタブを表示します。

### 4.2 メモ作成画面
- テキスト入力欄
- 作成ボタン（保存中は非活性・インジケータ表示）

### 4.3 メモ一覧画面
- 検索バー
- メモカード一覧
- ステータス一覧モーダル

### 4.4 設定画面
- 表示モードセクション
- ステータス管理セクション
- アプリ情報セクション

## 5. データ仕様

### 5.1 データベース
- DB名：`memos.db`
- バージョン：`26`
- テーブル：`status`, `category`, `memos`

#### 5.1.1 status テーブル
| カラム名 | 型 | 制約 | 説明 |
| --- | --- | --- | --- |
| status_id | INTEGER | PRIMARY KEY, AUTOINCREMENT | ステータスID |
| sort_no | INTEGER | NOT NULL | 表示順 |
| status_nm | TEXT | NOT NULL | ステータス名 |
| status_color | TEXT | NOT NULL | カラーコード |

初期データ:
- 1: 完了 / color "1"
- 2: 未完了 / color "2"

#### 5.1.2 category テーブル
| カラム名 | 型 | 制約 | 説明 |
| --- | --- | --- | --- |
| category_id | INTEGER | PRIMARY KEY, AUTOINCREMENT | カテゴリID |
| sort_no | INTEGER | NOT NULL | 表示順 |
| category_nm | TEXT | NOT NULL | カテゴリ名 |

#### 5.1.3 memos テーブル
| カラム名 | 型 | 制約 | 説明 |
| --- | --- | --- | --- |
| id | INTEGER | PRIMARY KEY, AUTOINCREMENT | メモID |
| content | TEXT | NOT NULL | メモ本文 |
| category_id | INTEGER | NOT NULL | カテゴリID（現状未使用） |
| status_id | INTEGER | NOT NULL | ステータスID |
| created_at | TEXT | NOT NULL | 作成日時（ISO-8601） |
| updated_at | TEXT |  | 更新日時（ISO-8601、null可） |

### 5.2 ステータス色
- ステータスの色は color_code で管理します。
- 固定ステータス：
  - 1: 完了（緑）
  - 2: 未完了（グレー）
- カスタム候補：11〜14（赤 / 黄 / 青 / 紫）

## 6. 同期・起動フロー

### 6.1 アプリ起動
- 起動時にホームウィジェットからの起動パラメータ（MEMO_ID）を確認します。
- MEMO_ID が指定されている場合は一覧タブを初期表示し、対象メモを編集状態にします。
- 起動時およびアプリ復帰時にホームウィジェットとの同期を実行します。

### 6.2 ウィジェット同期
- メモ・ステータス変更時はアプリからウィジェットへ同期します。
- ウィジェット側のデータはアプリ復帰時に取り込みます。

## 7. 制約・補足
- 固定ステータス（完了・未完了）は削除できません。
- カスタムステータスは最大 4 件です。
- 本アプリはローカルデータのみで動作し、外部サーバー連携は行いません。
